<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <!-- ====== TITLE ====== -->
  <title>Refer</title>

  <!-- ====== CSS LINKS ===== -->
  <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/blog.css">
    <link rel="stylesheet" href="css/author.css">
  <link rel="stylesheet" href="sinup_in.css">
  <link rel="stylesheet" href="css/modal.css">

  <style>
    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
  </style>

  <style>
    .mystyle {
      width: 100%;
      color: var(--white);
      font-size: 25px;
      box-sizing: border-box;
      display: block;
      transition: all 0.5s ease-out;
      top: 0px;
      transition: all 0.5s ease-in-out;
      transform: scale(1);
      z-index: 3;
      left: 0;
      position: absolute;
      top: 0;
      left: 0;
      background: #ffffff;
    }

    .close_nav_berger {
      position: absolute;
      right: 15px;
      top: 15px;
      z-index: 10;
      display: none;
    }

    .open_nav_burger {
      display: none;
    }

    #refer_block{
      margin-top: 0px;
    }

    #refer_block{
        margin-top: 5%;
      }

    #refer_column{
      height: 600px;
      overflow-y: scroll;
    }

    #image_column{
      height:620px;
    }

    @media (max-width: 920px) {

      .close_nav_berger,
      .open_nav_burger {
        display: block;
        cursor: pointer;
      }
      #refer_block{
        margin-top: 0px;
      }
      #image_column{
        height:100%;
      }
      #refer_column{
      height: 100%;
      overflow-y: visible;

    }
    }
    ::-webkit-scrollbar {
        -webkit-appearance: none;
        width: 7px;
    }
    ::-webkit-scrollbar-thumb {
        border-radius: 4px;
        background-color: rgba(0,0,0,.5);
        -webkit-box-shadow: 0 0 1px rgba(255,255,255,.5);
    }

    *{
      overflow-x: hidden;
    }

  </style>
</head>

<body>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
        <%- include('./partials/header') %>
<%- include('./partials/modal') %>
<script src="js/refer.js"></script>


  <!-- ======= main ===== -->
  <main style="height: 100%;">
    <div class="row">
      <div id="refer_column" class="col-sm-5">
        <div id="writer_block" style="text-align: center; vertical-align:middle; font-size: 30px; font-family: 'Times New Roman', Times, serif;">
          Join Us as a Writer
          <div style="text-align: center; font-size: 14px;">
            <div class="row">
              <div class="col-sm-2"></div>
              <div class="col-sm-8">
                Currently we are paying ₹100 for every 1000 views on a blog
                In blocks of 100 views so that you don't have to wait long
              </div>
              <div class="col-sm-2"></div>
            </div>
            <button style="margin-top:10px; border-radius: 5px;" type="button" class="btn btn-lg btn-danger" onclick="getModal()">Get Started</button>
          </div>
        </div>
        <div id="reader_block" style="text-align: center; vertical-align:middle; font-size: 30px; font-family: 'Times New Roman', Times, serif;">
          Help Us out as a Reader
          <div style="text-align: center; font-size: 14px;">
            <div class="row">
              <div class="col-sm-2"></div>
              <div class="col-sm-8">
                To increase user participation, we are incentivizing users to read blogs
                and there are prizes for that as well
              </div>
              <div class="col-sm-2"></div>
            </div>
            <button style="margin-top:10px; border-radius: 5px;" type="button" class="btn btn-lg btn-info" onclick="getModal()">Get Started</button>
          </div>
        </div>
        <div id="refer_block" style="text-align: center; vertical-align:middle; font-size: 30px; font-family: 'Times New Roman', Times, serif;">
          Refer A Friend
          <div style="text-align: center; font-size: 14px;">
            <div class="row">
              <div class="col-sm-2"></div>
              <div class="col-sm-8">
                We are inviting new writers to join our platform and grow together with us.
                For each Successful Referral you will receive ₹10
                Along with the following milestone rewards given below
                Sign Up below or Sign in if you already have an account to get started with it
                <div style="color: green">+50 Users<img style="height: 70px;" src="images/path.png">+₹1000</div>
                <div style="color: green">100 Users<img style="height: 70px;" src="images/path.png">+₹2000</div>
                <div style="color: green">150 Users<img style="height: 70px;" src="images/path.png">+₹3000</div>
              </div>
              <div class="col-sm-2"></div>
            </div>
            <div id="myModal" class="modal">

              <!-- Modal content -->
              <div class="modal-content" style="background: transparent; text-align: center;">
                <div class="row">
                  <div class="col-sm-2"></div>
                  <div class="col-sm-10">
                    <span class="close">&times;</span>
                    <form id="signup-form" class="sing_up_form_box c-flex ali-c jut-c">
                  <input required="required" type="name" name="username" id="username" placeholder="Enter Your Name">
                  <input type="referral" name="referral" id="referral" placeholder="Referall Code (if any)">
                  <input required="required" type="email" name="email" id="email" placeholder="Enter Your E-mail">
                  <input required="required" type="password" name="password" id="password" placeholder="Enter Your Password">
                  <div class="show_passwed_box r-flex ali-c ">
                      <input type="checkbox" id="showPass" onclick="myFunction()">
                      <label for="showPass">Show Password</label>
                  </div>
                  <button type="submit" class="sing_up_data_submit_btn">Sign Up</button>
                  <div class="have_ac"><span>Do have an account? or Sign In directly using an Google Account - </span> <a href="/login">Sign in</a></div>
                    </form>
                  </div>
                  <div class="col-sm-0"></div>
                </div>
              </div>
            
            </div>
            <button style="margin-top:10px; border-radius: 5px;" type="button" class="btn btn-lg btn-success" onclick="getModal()">Get Started</button>
          </div>
        </div>
      </div>
      <div class="col-sm-7" style="text-align: center;" id="image_column"><img style="width:100%; padding-right: 5px;" src="images/pexels-lil-artsy-1925536.jpg"><div style="font-size: 11px;"><a href="https://www.pexels.com/photo/person-holding-orange-pen-1925536/">Photo by lil artsy</a></div></div>      
    </div>
  </main>
  <!-- ======= main close ====== -->

  <script type="text/javascript" src="js/base_func.js"></script>
  <script>
    //  Modal Script
    // Get the modal
    var modal = document.getElementById("myModal");
    
    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];
    
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }
    
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
    </script>

  <script>
    function getModal(){
      let modal = document.getElementById("myModal");
      modal.style.display = "block";
    }
    function burgerFuncation() {
      var element = document.getElementById("myNAV");
      element.classList.toggle("mystyle");
      document.body.classList.toggle("noscroll");
    }
    function myFunction() {
      var x = document.getElementById("password");
      if (x.type === "password") {
        x.type = "text";
      }
      else {
        x.type = "password";
      }
    }

    var form=document.getElementById("signup-form");
    
        async function submitForm(event){
           event.preventDefault();
           //console.log("form submitted")

           //console.log(event.target)

           const body = {
            "username": event.target.username.value,
            "referral": event.target.referral.value,
            "email": event.target.email.value,
            "password": event.target.password.value,
           }

           //console.log(body)

          let data = await fetch(`/signup`, {
                    method: "POST",
                    headers: {
                        "content-type": "application/json",
                    },
                    body: JSON.stringify(body),
                })
            
          let user = await data

          //console.log(user.json())
          //console.log(user.status)
          if (user.status==201){window.location.href = "/login";}
        else{
                alert(await user.json())
            }
        }

        //Calling a function during form submission.
        form.addEventListener('submit', submitForm);

  </script>

<script>
    async function handleCredentialResponse(response) {
      //console.log("Encoded JWT ID token: " + response.credential);

      let data = await fetch(`https://oauth2.googleapis.com/tokeninfo?id_token=${response.credential}`)

      userInfo = await data.json()

      //console.log(userInfo)

      let res = await fetch("/googleLogin", {
        headers: {
            "content-type": "application/json"
        },
        method: "POST",
        body: JSON.stringify({
            name: await userInfo.name,
            email: await userInfo.email,
            picture: await userInfo.picture
        })
      })

      let result = await res.json()
      //console.log("result = ", result)

      localStorage.setItem("token", result["token"]);
      localStorage.setItem("user", result._id);
      window.location.href = "/";
    }
    window.onload = function () {
      google.accounts.id.initialize({
        client_id: "52924225802-18va5kl4741f09h2plf21kppmrbj8t2m.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
      google.accounts.id.renderButton(
        document.getElementById("buttonDiv"),
        { theme: "outline", size: "large" }  // customization attributes
      );
      google.accounts.id.prompt(); // also display the One Tap dialog
    }
</script>
<script>
  //nav bar scripts
  function changeClass(choice){
      //console.log("change class")
      let elem = document.getElementsByClassName("dropdown-content")[0]
      //console.log(elem.style.display)
      if (elem.style.display==""){
          elem.style.display = "block"
      }
      else{
          elem.style.display = ""
      }
  }


  function setWriteBlog(){
      let doc = document.getElementById("write_blog")
      console.log(localStorage.getItem("user"))
      if (localStorage.getItem("userId")){
          let elem = `
          <a class="nav_manu_link write_nav_btn r-flex ali-c">
              <svg width="16" height="16" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20.847 0.543159L21.4504 1.14002C22.2818 1.9635 22.156 3.42329 21.1671 4.40053L8.72436 16.7091L4.69301 18.1679C4.18679 18.352 3.69387 18.1133 3.59365 17.6368C3.55978 17.464 3.57572 17.2852 3.63967 17.1209L5.14299 13.0986L17.551 0.823382C18.5399 -0.15386 20.0156 -0.280315 20.847 0.543159ZM8.18132 1.76724C8.31562 1.76724 8.44861 1.79341 8.57268 1.84425C8.69676 1.89509 8.80949 1.9696 8.90446 2.06354C8.99942 2.15748 9.07475 2.269 9.12614 2.39174C9.17754 2.51448 9.20399 2.64603 9.20399 2.77888C9.20399 2.91173 9.17754 3.04328 9.12614 3.16602C9.07475 3.28875 8.99942 3.40028 8.90446 3.49421C8.80949 3.58815 8.69676 3.66267 8.57268 3.71351C8.44861 3.76435 8.31562 3.79052 8.18132 3.79052H4.09066C3.54821 3.79052 3.02797 4.00368 2.64439 4.38312C2.26082 4.76256 2.04533 5.27719 2.04533 5.81379V17.9534C2.04533 18.4901 2.26082 19.0047 2.64439 19.3841C3.02797 19.7636 3.54821 19.9767 4.09066 19.9767H16.3626C16.9051 19.9767 17.4253 19.7636 17.8089 19.3841C18.1925 19.0047 18.408 18.4901 18.408 17.9534V13.9069C18.408 13.6386 18.5157 13.3813 18.7075 13.1916C18.8993 13.0018 19.1594 12.8953 19.4306 12.8953C19.7019 12.8953 19.962 13.0018 20.1538 13.1916C20.3456 13.3813 20.4533 13.6386 20.4533 13.9069V17.9534C20.4533 19.0267 20.0223 20.0559 19.2552 20.8148C18.488 21.5737 17.4476 22 16.3626 22H4.09066C3.00575 22 1.96528 21.5737 1.19813 20.8148C0.430979 20.0559 0 19.0267 0 17.9534V5.81379C0 4.74058 0.430979 3.71132 1.19813 2.95245C1.96528 2.19357 3.00575 1.76724 4.09066 1.76724H8.18132Z" fill="#ffffff"/>
              </svg>
              <span onclick=newBlog()>Write Blog</span>
          </a>
          `
          doc.innerHTML = elem
          }
      else{
          let elem = `
          <a class="nav_manu_link write_nav_btn r-flex ali-c" href="/login">
              <span>Sign up / Sign In</span>
          </a>
          `
          doc.innerHTML = elem
      }
  }

  function setProfile(){
      let doc = document.getElementById("profile_image")
      if (localStorage.getItem("userId")){
          let elem = `
          <a class="nav_manu_link" onclick="changeClass()">
              <img style="max-height: 30px;" src="user-bg.png">
              <br>
              <div class="dropdown-content">
                  <div>
                  <a class="profile_points" href="/dashboard"><div class="dropdown_a">Dashboard</div></a>
                  </div>
                  <a class="profile_points"  ><div class="dropdown_a" onclick="logout()">Signout</div></a>
              </div>
          </a>
          `
          doc.innerHTML = elem
          }
  }

  setProfile();
  setWriteBlog();

  async function logout(){
      let data = await fetch("/logout",{
          "method": "POST",
          headers: {
              "content-type": "application/json",
          },
      })
      let res = await data.json();

      //console.log("res = ", res)

      // localStorage.clear();
      localStorage.removeItem("user")
      localStorage.removeItem("token")
      localStorage.removeItem("userId");

      window.location.href = "/"
  }
</script>


<%- include('./partials/footer') %>
</body>

</html>