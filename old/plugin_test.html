<script src="https://cdn.jsdelivr.net/npm/@editorjs/editorjs@latest"></script>
<script src="simple-image.js"></script>
<link href="simple-image.css" rel="stylesheet"/>

<div id="editorjs"></div>

<button id="save-button">Save</button>
<pre id="output"></pre>

<script>

    function ImageUploaded(e){
        console.log(e.files)
        console.log(e.id)
        let body = new FormData();
        body.append("blogId", "6437cf61159891149608d102")
        body.append("userId", "641be792bacccc03c37fc0e4")
        body.append("image", e.files[0])
        fetch ("http://localhost:8080/image", 
        {
            method: "POST",
            body: body
        })
        .then(res => res.json())
        .then(data=>{
          console.log(data.file.url);
          elem = document.getElementById("image_"+e.id)
          elem.src = data.file.url;
        })
        .catch((err) => {
            console.log(err)
        });
    }

class SimpleImage {
  static get toolbox() {
    return {
      title: 'Image',
      icon: '<svg width="17" height="15" viewBox="0 0 336 276" xmlns="http://www.w3.org/2000/svg"><path d="M291 150V79c0-19-15-34-34-34H79c-19 0-34 15-34 34v42l67-44 81 72 56-29 42 30zm0 52l-43-30-56 30-81-67-66 39v23c0 19 15 34 34 34h178c17 0 31-13 34-29zM79 0h178c44 0 79 35 79 79v118c0 44-35 79-79 79H79c-44 0-79-35-79-79V79C0 35 35 0 79 0z"/></svg>'
    };
  }

  render(){
    var uid = Date.now().toString(36) + Math.random().toString(36).substr(2);
    var div = document.createElement("div")
    div.innerHTML = '<input type="file" id="' + uid + '" onChange="ImageUploaded(this)" hidden/>'+ '<label for="' + uid + '"><img id=' + "image_" + uid + ' style="background-color:grey; width:200px; height:200px"></img></label>'
    var i=i+1
    return div;
  }

  save(blockContent){
    console.log(blockContent.getElementsByTagName('img')[0])
    var img = blockContent.getElementsByTagName('img')[0]
    return {
      url: img.src
    }
  }
}
    const editor = new EditorJS({
      autofocus: true,
      tools: {
        image: SimpleImage
      }
    });
    const saveButton = document.getElementById('save-button');
    const output = document.getElementById('output');

    saveButton.addEventListener('click', () => {
      editor.save().then( savedData => {
        output.innerHTML = JSON.stringify(savedData, null, 4);
      })
    })
</script>